enum PostModerationStatus {
  PENDING
  APPROVED
  REJECTED
}

enum PostReportCategory {
  OFF_TOPIC
  SPAM
  INAPPROPRIATE
  IMPROPER_TAGGING
  ILLEGAL
  OTHER
}

enum PostSourceType {
  VIDEOGAME
  ANIME
  MANGA
  OTHER
}

model Post {
  id               String                   @id @default(uuid())
  createdAt        DateTime                 @default(now())
  updatedAt        DateTime                 @default(now())
  description      String                   @db.VarChar(500)
  sourceLink       String                   @db.VarChar(450)
  isNsfw           Boolean                  @default(false)
  searchable       Unsupported("tsvector")?
  likes            Int                      @default(0)
  views            Int                      @default(0)
  moderationStatus PostModerationStatus     @default(PENDING)
  imageUrls        String[]
  imageHashes      String[]                 @default([])
  imageWidths      Int[]
  imageHeights     Int[]
  commentCount     Int                      @default(0)
  comments         Comment[]
  tags             Tag[]
  tagString        String                   @db.VarChar(1520)
  artists          Artist[]
  artistString     String                   @db.VarChar(380)
  author           User?                    @relation(name: "created posts", fields: [authorId], references: [id], onDelete: SetNull)
  authorId         String?
  likedBy          User[]                   @relation(name: "liked posts")
  collections      PostCollection[]
  matchingReports  PostReport[]             @relation(name: "post matching reports")
  sources          PostSource[]

  @@index([authorId])
  @@index([moderationStatus])
  @@index([moderationStatus, createdAt(sort: Desc)])
  @@index([moderationStatus, likes(sort: Desc)])
  @@index([moderationStatus, commentCount(sort: Desc)])
}

model PostSource {
  id            String         @id @default(uuid())
  sourceType    PostSourceType
  sourceTitle   String         @db.VarChar(200)
  characterName String         @db.VarChar(200)
  posts         Post[]

  @@unique([sourceTitle, sourceType, characterName])
}

model PostReport {
  id           String                 @id @default(uuid())
  createdAt    DateTime               @default(now())
  category     PostReportCategory
  description  String?                @db.VarChar(250)
  reviewStatus ModerationReportStatus @default(NOT_REVIEWED)
  post         Post?                  @relation(fields: [postId], references: [id], onDelete: SetNull, name: "post matching reports")
  postId       String?
  author       User?                  @relation(fields: [authorId], references: [id], onDelete: SetNull, name: "posts reported by")
  authorId     String?

  @@index([postId])
  @@index([authorId])
  @@index([reviewStatus, createdAt])
}
